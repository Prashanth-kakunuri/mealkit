<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css" integrity="sha512-5Hs3dF2AEPkpNAR7UiOHba+lRSJNeM2ECkwxUIxC1Q/FLycGTbNapWXB4tP889k5T5Ju8fs4b1P5z/iB4nMfSQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <style>
        
        body {
            background-color: #f8f9fa;
        }

        .profile-header {
            background-color: #ffc107;
            color: white;
            padding: 40px 0;
            text-align: center;
        }

        .profile-header h1 {
            margin-bottom: 10px;
            font-size: 2rem;
        }

        .profile-header p {
            font-size: 1.2rem;
        }
        .profile-container {
    position: relative;
    display: inline-block;
}

.profile-img {
    width: 150px;
    height: 150px;
    border-radius: 50%;
}

.edit-icon {
    position: absolute;
    bottom: 5px;
    right: 5px;
    font-size: 1.5em;
    cursor: pointer;
    /* background: rgba(0, 0, 0, 0.5); */
    color: white;
    border-radius: 50%;
    padding: 5px;
}

.edit-icon:hover {
    background: rgba(0, 0, 0, 0.5);
}


        .profile-card {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .profile-card h3 {
            font-size: 1.5rem;
            color: #343a40;
            margin-bottom: 20px;
        }

        .profile-card ul {
            list-style-type: none;
            padding-left: 0;
        }

        .profile-card li {
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .order-history, .favorite-meal-kits {
            margin-top: 30px;
        }

        .order-history table, .favorite-meal-kits table {
            width: 100%;
            border-collapse: collapse;
        }

        .order-history th, .favorite-meal-kits th,
        .order-history td, .favorite-meal-kits td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .order-history th, .favorite-meal-kits th {
            background-color: #ffc107;
            color: white;
        }

        .order-history .view-order, .favorite-meal-kits .view-meal {
            color: #ffc107;
            font-weight: bold;
            text-decoration: none;
        }

        .order-history .view-order:hover, .favorite-meal-kits .view-meal:hover {
            color: #ffc107;
        }

        .favorite-meal-kits .edit-btn, .favorite-meal-kits .delete-btn {
            color: #007bff;
            font-weight: bold;
            cursor: pointer;
        }

        .favorite-meal-kits .edit-btn:hover, .favorite-meal-kits .delete-btn:hover {
            color: #0056b3;
        }

        .favorite-meal-kits .edit-form {
            display: none;
            margin-top: 20px;
        }

        .favorite-meal-kits .edit-form input,
        .favorite-meal-kits .edit-form select {
            margin-bottom: 10px;
        }
    </style>
</head>

<body>

    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-secondary">
        <div class="container-fluid">
            <a class="navbar-brand fw-semibold text-warning fs-4" href="#">Meal Kits.</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link fw-semibold text-light px-3" href="index.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link fw-semibold text-light px-3" href="categories.html">Categories</a></li>
                    <li class="nav-item"><a class="nav-link fw-semibold text-light px-3" href="about-us.html">About Us</a></li>
                    <li class="nav-item"><a class="nav-link fw-semibold text-light px-3" href="contact.html">Contact</a></li>
                    <li class="nav-item"><a class="nav-link fw-semibold text-light px-3" href="blog.html">Blog</a></li>
                    <li class="nav-item"><a class="nav-link fw-semibold text-light px-3" href="faq.html">FAQ</a></li>
                    <li class="nav-item"><a class="nav-link fw-semibold active px-3" href="userprofile.html">User Profile</a></li>
                    
                    <!-- card Icon with Card Symbol -->
                    <li class="nav-item">
                        <a class="nav-link fw-semibold text-light px-3 position-relative" href="card.html">
                            <i class="fa-solid fa-cart-shopping fs-4"></i>
                        </a>
                    </li>

                    <!-- Logout Icon with Symbol -->
                    <li class="nav-item">
                        <a class="nav-link fw-semibold text-light px-3" href="" onclick="logoutUser()">
                            <i class="fa-solid fa-right-from-bracket"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    
    <div class="container">
        <!-- User Profile Header -->
        <div class="profile-header">
<!-- Profile image and pencil icon -->
<div class="profile-container">
    <img id="profileImg" src="https://via.placeholder.com/150" alt="User Profile Picture" class="profile-img">
    <label for="fileInput" class="edit-icon">
        <i class="fas fa-pencil-alt"></i>
    </label>
</div>

<!-- File input for uploading image (hidden) -->
<input type="file" id="fileInput" style="display: none;" onchange="updateProfileImage(event)">


            <h1 id="welcomeMessage">John Doe</h1>
            <p>Manage your account, view order history, and favorite your meal kits.</p>
        </div>

        <!-- Profile Info Section -->
        <div class="profile-card">
            <h3>Profile Information</h3>
            <ul>
                <li><strong>Name:</strong> <span id="userName">John Doe</span></li>
                <li><strong>Email:</strong> <span id="userEmail">john.doe@example.com</span></li>
                <li><strong>Phone:</strong> <span id="userPhone">+1234567890</span></li>
                <li><strong>Address:</strong> <span id="userAddress">123 Meal Street, Food City</span></li>
                <li><a class="btn btn-info" href="edit-profile.html">Edit Profile</a></li>
            </ul>
        </div>
    </div>
        <!-- Order History Section -->
        <div class="order-history">
            <h3>Order History</h3>
            <table>
                <thead>
                    <tr>
                        <th>Order #</th>
                        <th>Date</th>
                        <th>Total</th>
                        <th>Status</th>
                        <!-- <th>Action</th> -->
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>12345</td>
                        <td>01/12/2024</td>
                        <td>&#8377;140</td>
                        <td>Delivered</td>
                        <!-- <td><a href="order-details.html" class="view-order">View Order</a></td> -->
                    </tr>
                    <tr>
                        <td>12346</td>
                        <td>02/12/2024</td>
                        <td>&#8377;140</td>
                        <td>Pending</td>
                        <!-- <td><a href="order-details.html" class="view-order">View Order</a></td> -->
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="favorite-meal-kits">
            <h3>Favorite Meal Kits</h3>
        
            <!-- Add Favorite Button -->
            <button class="btn btn-primary mb-3" onclick="showAddMealForm()">Add to Favorites</button>
        
            <!-- Table to display favorite meal kits -->
            <table>
                <thead>
                    <tr>
                        <th>Meal Kit</th>
                        <th>Category</th>
                        <th>Price</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="favoriteMealsList">
                    <tr>
                        <td>Butter Chicken</td>
                        <td>Non-Vegan</td>
                        <td>&#8377;140</td>
                        <td>
                            <span class="edit-btn" onclick="toggleEditForm(0)">Edit</span> | 
                            <span class="delete-btn" onclick="deleteMealKit(0)">Delete</span>
                            <div class="edit-form" id="edit-form-0">
                                <input type="text" value="Butter Chicken" id="meal-name-0" class="form-control">
                                <select class="form-select" id="meal-category-0">
                                    <option value="Non-Vegan" selected>Non-Vegan</option>
                                    <option value="Vegan">Vegan</option>
                                </select>
                                <input type="number" value="15.00" id="meal-price-0" class="form-control" step="0.01">
                                <button class="btn btn-primary mt-2" onclick="saveMealKit(0)">Save</button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>Vegan Stir Fry</td>
                        <td>Vegan</td>
                        <td>&#8377;140</td>
                        <td>
                            <span class="edit-btn" onclick="toggleEditForm(1)">Edit</span> | 
                            <span class="delete-btn" onclick="deleteMealKit(1)">Delete</span>
                            <div class="edit-form" id="edit-form-1">
                                <input type="text" value="Vegan Stir Fry" id="meal-name-1" class="form-control">
                                <select class="form-select" id="meal-category-1">
                                    <option value="Non-Vegan">Non-Vegan</option>
                                    <option value="Vegan" selected>Vegan</option>
                                </select>
                                <input type="number" value="12.00" id="meal-price-1" class="form-control" step="0.01">
                                <button class="btn btn-primary mt-2" onclick="saveMealKit(1)">Save</button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        
            <!-- Add Meal Kit Form (Initially hidden) -->
            <div class="edit-form" id="addMealForm" style="display: none;">
                <input type="text" id="new-meal-name" class="form-control" placeholder="Meal Kit Name">
                <select class="form-select" id="new-meal-category">
                    <option value="Non-Vegan">Non-Vegan</option>
                    <option value="Vegan">Vegan</option>
                </select>
                <input type="number" id="new-meal-price" class="form-control" placeholder="Price" step="0.01">
                <button class="btn btn-primary mt-2" onclick="addMealKit()">Add Meal Kit</button>
                <button class="btn btn-secondary mt-2" onclick="hideAddMealForm()">Cancel</button>
            </div>
        </div>
        

    </div>

    <!-- Bootstrap JS, Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>

    <script>
// On page load, check if user is logged in and load profile image
window.onload = function() {
    // Check if the user is logged in
    if (!localStorage.getItem('isLoggedIn')) {
        window.location.href = 'loginpage.html';  // Redirect to login page if not logged in
    } else {
        history.replaceState(null, null, window.location.href);
        loadProfileData();  // Load profile data (including image)
    }
};

// Load saved profile data (including image) from localStorage
function loadProfileData() {
    const userProfile = JSON.parse(localStorage.getItem("userProfile"));
    if (userProfile) {
        document.getElementById('welcomeMessage').textContent = `${userProfile.name}`;
        document.getElementById('userName').textContent = userProfile.name;
        document.getElementById('userEmail').textContent = userProfile.email;
        document.getElementById('userPhone').textContent = userProfile.phone;
        document.getElementById('userAddress').textContent = userProfile.address;
    }

    // Load the profile image from localStorage if it exists
    const profileImage = localStorage.getItem("profileImage");
    if (profileImage) {
        document.getElementById('profileImg').src = profileImage;  // Set the stored image as the profile image
    }
}

// Update profile image and store it in localStorage
function updateProfileImage(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const imageUrl = e.target.result;  // Get the base64 string of the uploaded image

            // Update the profile image on the page
            document.getElementById('profileImg').src = imageUrl;

            // Save the updated profile image URL in localStorage
            localStorage.setItem("profileImage", imageUrl);
        };
        reader.readAsDataURL(file);  // Convert the uploaded file to base64 string
    }
}

// Handle user logout (without clearing the profile image)
function logoutUser() {
    // Remove only the login session, not the profile image
    localStorage.removeItem('isLoggedIn');  // Logout user by removing login flag

    // Redirect to login page
    window.location.href = 'loginpage.html';
}



    // Update profile details and save to localStorage
    function saveProfileData() {
        const name = document.getElementById('userName').textContent;
        const email = document.getElementById('userEmail').textContent;
        const phone = document.getElementById('userPhone').textContent;
        const address = document.getElementById('userAddress').textContent;

        const userProfile = {
            name,
            email,
            phone,
            address
        };

        // Save profile data to localStorage
        localStorage.setItem('userProfile', JSON.stringify(userProfile));
    }

    // Logout function
    function logoutUser() {
        localStorage.clear();  // Clear the localStorage
        window.location.href = 'loginpage.html';  // Redirect to login page
    }

    // Save user profile data when logging out or navigating away
    window.onbeforeunload = function() {
        saveProfileData();  // Save profile data before leaving the page
    };



        // Load profile data when the page loads
        loadProfileData();


// Function to show the form for adding a new favorite meal kit
function showAddMealForm() {
    document.getElementById('addMealForm').style.display = 'block';  // Show the form
}

// Function to hide the "Add Meal Kit" form
function hideAddMealForm() {
    document.getElementById('addMealForm').style.display = 'none';  // Hide the form
}

// Function to add the new favorite meal kit to the list
function addMealKit() {
    // Get values from the input fields
    const name = document.getElementById('new-meal-name').value;
    const category = document.getElementById('new-meal-category').value;
    const price = document.getElementById('new-meal-price').value;

    // Validate the inputs
    if (!name || !category || !price) {
        alert('Please fill in all the fields.');
        return;
    }

    // Create a new row in the table
    const tableBody = document.getElementById('favoriteMealsList');
    const newRow = document.createElement('tr');
    
    newRow.innerHTML = `
        <td>${name}</td>
        <td>${category}</td>
        <td>&#8377;${price}</td>
        <td>
            <span class="edit-btn" onclick="toggleEditForm(${tableBody.rows.length})">Edit</span> | 
            <span class="delete-btn" onclick="deleteMealKit(${tableBody.rows.length})">Delete</span>
            <div class="edit-form" id="edit-form-${tableBody.rows.length}" style="display: none;">
                <input type="text" value="${name}" id="meal-name-${tableBody.rows.length}" class="form-control">
                <select class="form-select" id="meal-category-${tableBody.rows.length}">
                    <option value="Non-Vegan" ${category === 'Non-Vegan' ? 'selected' : ''}>Non-Vegan</option>
                    <option value="Vegan" ${category === 'Vegan' ? 'selected' : ''}>Vegan</option>
                </select>
                <input type="number" value="${price}" id="meal-price-${tableBody.rows.length}" class="form-control" step="0.01">
                <button class="btn btn-primary mt-2" onclick="saveMealKit(${tableBody.rows.length})">Save</button>
            </div>
        </td>
    `;
    
    // Append the new row to the table
    tableBody.appendChild(newRow);

    // Hide the form and clear input fields
    hideAddMealForm();
    document.getElementById('new-meal-name').value = '';
    document.getElementById('new-meal-category').value = 'Non-Vegan';
    document.getElementById('new-meal-price').value = '';
}

// Function to delete a favorite meal kit
function deleteMealKit(index) {
    if (confirm('Are you sure you want to delete this meal kit?')) {
        document.querySelectorAll('.favorite-meal-kits tbody tr')[index].remove();
    }
}


    </script>
</body>

</html>
